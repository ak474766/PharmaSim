(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10272,t=>{"use strict";var e=t.i(59141);t.i(36180);var a=t.i(98925);let r=[{id:"q1",title:"Synthesis Master",description:"Build 3 Molecules",total:3,type:"build_molecule"},{id:"q2",title:"Lab Rat",description:"Earn 500 XP",total:500,type:"earn_xp"},{id:"q3",title:"Daily Discovery",description:"Build 1 Complex Molecule",total:1,type:"build_molecule"}];t.s(["UserService",0,{async getProfile(t,o,n){let s=(0,a.doc)(e.db,"users",t),i=await (0,a.getDoc)(s);if(i.exists()){let t=i.data(),e=Date.now();if(!t.lastLogin||e-t.lastLogin>864e5||!t.dailyQuests){let o=r.slice(0,2).map(t=>({...t,progress:0,completed:!1}));await (0,a.updateDoc)(s,{dailyQuests:o,lastLogin:e}),t.dailyQuests=o}return t}{let e=r.slice(0,2).map(t=>({...t,progress:0,completed:!1})),i={uid:t,email:o,displayName:n||"Researcher "+t.slice(0,4),xp:0,level:1,reputation:100,moleculesDiscovered:0,dailyQuests:e,lastLogin:Date.now(),achievements:[],topicMastery:{kinetics:1,regulatory:1,pharmacology:1,chemistry:1}};return await (0,a.setDoc)(s,i),i}},async updateDisplayName(t,r){let o=r.trim();if(!o)throw Error("Display name cannot be empty");let n=(0,a.doc)(e.db,"users",t);return await (0,a.updateDoc)(n,{displayName:o}),o},async updateQuestProgress(t,r,o){let n=(0,a.doc)(e.db,"users",t),s=await (0,a.getDoc)(n);if(s.exists()){let t=s.data(),e=!1,i=(t.dailyQuests||[]).map(t=>{if(t.type===r&&!t.completed){let a=Math.min(t.progress+o,t.total);return e=!0,{...t,progress:a,completed:a>=t.total}}return t});e&&await (0,a.updateDoc)(n,{dailyQuests:i})}},async unlockAchievement(t,r){let o=(0,a.doc)(e.db,"users",t),n=await (0,a.getDoc)(o);if(n.exists()){let t=n.data();if(!(t.achievements||[]).find(t=>t.id===r.id)){let e={...r,unlockedAt:Date.now()};return await (0,a.updateDoc)(o,{achievements:[...t.achievements||[],e]}),e}}return null},async addXP(t,r){let o=(0,a.doc)(e.db,"users",t),n=await (0,a.getDoc)(o);if(n.exists()){let t=n.data(),e=t.xp+r,s=Math.floor(e/1e3)+1;return await (0,a.updateDoc)(o,{xp:e,level:s,moleculesDiscovered:t.moleculesDiscovered+1}),{newXP:e,newLevel:s}}return null},async getLeaderboard(){let t=(0,a.query)((0,a.collection)(e.db,"users"),(0,a.orderBy)("xp","desc"),(0,a.limit)(50));return(await (0,a.getDocs)(t)).docs.map(t=>t.data())},async getUserRank(t){let r=(0,a.query)((0,a.collection)(e.db,"users"),(0,a.orderBy)("xp","desc"),(0,a.limit)(100)),o=(await (0,a.getDocs)(r)).docs.map(t=>t.id).indexOf(t);return -1!==o?o+1:1e3},async updateTopicMastery(t,r,o){let n=(0,a.doc)(e.db,"users",t),s=await (0,a.getDoc)(n);if(s.exists()){let t=s.data(),e=Math.max(1,Math.min(5,(t.topicMastery?.[r]||1)+o));return await (0,a.updateDoc)(n,{[`topicMastery.${r}`]:e}),e}return 1}}])},32341,t=>{"use strict";var e=t.i(43476),a=t.i(71645);t.i(51718);var r=t.i(6973),o=t.i(59141),n=t.i(10272);let s=(0,a.createContext)({user:null,profile:null,loading:!0,refreshProfile:async()=>{}});t.s(["AuthProvider",0,({children:t})=>{let[i,l]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,y]=(0,a.useState)(!0),h=async t=>{try{let e=await n.UserService.getProfile(t.uid,t.email||"",t.displayName||"");u(e)}catch(t){console.error("Error fetching profile:",t)}};(0,a.useEffect)(()=>{let t=(0,r.onAuthStateChanged)(o.auth,async t=>{l(t),t?await h(t):u(null),y(!1)});return()=>t()},[]);let x=async()=>{i&&await h(i)};return(0,e.jsx)(s.Provider,{value:{user:i,profile:c,loading:d,refreshProfile:x},children:t})},"useAuth",0,()=>(0,a.useContext)(s)])},44586,t=>{"use strict";var e=t.i(43476),a=t.i(71645),r=t.i(32341);t.i(47167);class o extends Error{constructor(t){super(`UltraContext request failed: ${t.status} ${t.url}`),this.name="UltraContextHttpError",this.status=t.status,this.url=t.url,this.bodyText=t.bodyText}}class n{constructor(t){this.baseUrl=(t.baseUrl??"https://api.ultracontext.ai").replace(/\/+$/,""),this.apiKey=t.apiKey,this.fetchFn=t.fetch??fetch,this.headers=t.headers,this.timeoutMs=t.timeoutMs}async create(t={}){return this.request("/contexts",{method:"POST",body:t})}async append(t,e){return this.request(`/contexts/${encodeURIComponent(t)}`,{method:"POST",body:e})}async get(t,e){if(!t||"object"==typeof t){let e=new URLSearchParams;"object"==typeof t&&t.limit&&e.set("limit",String(t.limit));let a=e.toString();return this.request(`/contexts${a?`?${a}`:""}`,{method:"GET"})}let a=new URLSearchParams;e?.version!==void 0&&a.set("version",String(e.version)),e?.at!==void 0&&a.set("at",String(e.at)),e?.before&&a.set("before",e.before),e?.history&&a.set("history","true");let r=a.toString();return this.request(`/contexts/${encodeURIComponent(t)}${r?`?${r}`:""}`,{method:"GET"})}async update(t,e,a){let r=a?.metadata?{updates:Array.isArray(e)?e:[e],metadata:a.metadata}:e;return this.request(`/contexts/${encodeURIComponent(t)}`,{method:"PATCH",body:r})}async delete(t,e,a){return this.request(`/contexts/${encodeURIComponent(t)}`,{method:"DELETE",body:{ids:e,metadata:a?.metadata}})}async request(t,e){let a,r=`${this.baseUrl}${t.startsWith("/")?"":"/"}${t}`,n={Authorization:`Bearer ${this.apiKey}`,...this.headers??{},...e.headers??{}};void 0!==e.body&&(n["Content-Type"]=n["Content-Type"]??"application/json",a=JSON.stringify(e.body));let i=this.timeoutMs?new AbortController:void 0,l=this.timeoutMs?setTimeout(()=>i?.abort(),this.timeoutMs):void 0;try{let t=await this.fetchFn(r,{method:e.method,headers:n,body:a,signal:i?.signal});if(!t.ok){let e=await s(t);throw new o({status:t.status,url:r,bodyText:e})}if(204===t.status)return;if((t.headers.get("content-type")??"").includes("application/json"))return await t.json();return await t.text()}finally{l&&clearTimeout(l)}}}async function s(t){try{return await t.text()}catch{return}}let i=null;function l(){return i||(i=new n({apiKey:"uc_live_OuU12w0yaepGFV1sIYl1sKtpT6E3TAvx"})),i}let c={async createContext(t){try{let e=l(),a=await e.create({metadata:t});return console.log("[UltraContext] Created context:",a.id),a}catch(t){throw console.error("[UltraContext] Failed to create context:",t),t}},async forkContext(t,e){try{let a=l(),r=await a.create({from:t,...void 0!==e&&{version:e}});return console.log("[UltraContext] Forked context:",r.id,"from:",t),r}catch(t){throw console.error("[UltraContext] Failed to fork context:",t),t}},async getContext(t,e){try{let a=l();return await a.get(t,e)}catch(t){throw console.error("[UltraContext] Failed to get context:",t),t}},async listContexts(){try{let t=l();return(await t.get()).data||[]}catch(t){throw console.error("[UltraContext] Failed to list contexts:",t),t}},async appendMessage(t,e){try{let a=l();await a.append(t,e),console.log("[UltraContext] Appended message(s) to:",t)}catch(t){throw console.error("[UltraContext] Failed to append message:",t),t}},async updateMessage(t,e){try{let a=l();await a.update(t,e),console.log("[UltraContext] Updated message in:",t)}catch(t){throw console.error("[UltraContext] Failed to update message:",t),t}},async deleteMessage(t,e){try{let a=l();await a.delete(t,e),console.log("[UltraContext] Deleted message from:",t)}catch(t){throw console.error("[UltraContext] Failed to delete message:",t),t}},async getContextAtVersion(t,e){return this.getContext(t,{version:e})},async getContextWithHistory(t){return this.getContext(t,{history:!0})},async createMoleculeAnalysisContext(t,e){return this.createContext({userId:t,feature:"molecule-analysis",createdAt:new Date().toISOString(),moleculeName:e})},async createQuizContext(t,e){return this.createContext({userId:t,feature:"quiz",createdAt:new Date().toISOString(),topic:e})},async createTrialContext(t,e){return this.createContext({userId:t,feature:"clinical-trial",createdAt:new Date().toISOString(),trialId:e})},async saveConversationExchange(t,e,a){await this.appendMessage(t,[{role:"user",content:e},{role:"assistant",content:a}])}},u=(0,a.createContext)(null);function d({children:t}){let{user:o}=(0,r.useAuth)(),[n,s]=(0,a.useState)({activeContextId:null,isLoading:!1,error:null}),i=t=>{s(e=>({...e,isLoading:t}))},l=t=>{s(e=>({...e,error:t,isLoading:!1}))},d=(0,a.useCallback)(()=>{s(t=>({...t,error:null}))},[]),y=(0,a.useCallback)(t=>{s(e=>({...e,activeContextId:t}))},[]),h=(0,a.useCallback)(async t=>{i(!0);try{let e=await c.createContext({userId:o?.uid,...t});return s(t=>({...t,activeContextId:e.id,isLoading:!1,error:null})),e}catch(t){return l(t instanceof Error?t.message:"Failed to create context"),null}},[o?.uid]),x=(0,a.useCallback)(async t=>{if(!o?.uid)return l("User not authenticated"),null;i(!0);try{let e=await c.createMoleculeAnalysisContext(o.uid,t);return s(t=>({...t,activeContextId:e.id,isLoading:!1,error:null})),e}catch(t){return l(t instanceof Error?t.message:"Failed to create molecule context"),null}},[o?.uid]),p=(0,a.useCallback)(async t=>{if(!o?.uid)return l("User not authenticated"),null;i(!0);try{let e=await c.createQuizContext(o.uid,t);return s(t=>({...t,activeContextId:e.id,isLoading:!1,error:null})),e}catch(t){return l(t instanceof Error?t.message:"Failed to create quiz context"),null}},[o?.uid]),C=(0,a.useCallback)(async t=>{if(!o?.uid)return l("User not authenticated"),null;i(!0);try{let e=await c.createTrialContext(o.uid,t);return s(t=>({...t,activeContextId:e.id,isLoading:!1,error:null})),e}catch(t){return l(t instanceof Error?t.message:"Failed to create trial context"),null}},[o?.uid]),m=(0,a.useCallback)(async()=>{if(!n.activeContextId)return console.warn("[UltraContext] No active context"),[];try{return(await c.getContext(n.activeContextId)).data||[]}catch(t){return console.error("[UltraContext] Failed to get messages:",t),[]}},[n.activeContextId]),g=(0,a.useCallback)(async t=>{if(!n.activeContextId)return void l("No active context");try{await c.appendMessage(n.activeContextId,t)}catch(t){l(t instanceof Error?t.message:"Failed to append message")}},[n.activeContextId]),v=(0,a.useCallback)(async(t,e)=>{if(!n.activeContextId)return void l("No active context");try{await c.saveConversationExchange(n.activeContextId,t,e)}catch(t){l(t instanceof Error?t.message:"Failed to save exchange")}},[n.activeContextId]),f=(0,a.useCallback)(async()=>{if(!n.activeContextId)return console.warn("[UltraContext] No active context"),null;try{return await c.getContextWithHistory(n.activeContextId)}catch(t){return console.error("[UltraContext] Failed to get history:",t),null}},[n.activeContextId]),w={...n,createContext:h,createMoleculeContext:x,createQuizContext:p,createTrialContext:C,setActiveContext:y,getMessages:m,appendMessage:g,saveExchange:v,getHistory:f,clearError:d};return(0,e.jsx)(u.Provider,{value:w,children:t})}function y(){let t=(0,a.useContext)(u);if(!t)throw Error("useUltraContext must be used within an UltraContextProvider");return t}t.s(["UltraContextProvider",()=>d,"default",0,d,"useUltraContext",()=>y],44586)}]);